user nginx;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    quic_qlog on;
    quic_qlog_path /var/log/nginx/qlog;

    server {
        listen 443 quic;

        ssl_certificate     /etc/nginx/ssl/server.crt;
        ssl_certificate_key /etc/nginx/ssl/server.key;
        ssl_protocols       TLSv1.3;

        add_header Cache-Control "no-store";

        # CPU-dominated: tiny response, handshake/protocol overhead dominates
        location /small {
            return 200 "OK\n";
        }

        # Network-dominated: static file transfers
        location ~ ^/size/(?<mb>\d+)m$ {
            root /data/sizes;
            try_files /$mb.bin =404;
        }

        # Throttled streaming: 100 MB at 1 MB/s (~8 Mbps, ~1080p video)
        location /stream {
            root /data/sizes;
            try_files /100.bin =404;
            limit_rate 1m;
        }
    }
}
